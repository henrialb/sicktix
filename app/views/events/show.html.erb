<% relative_time = @event.starts_at > Time.now ? "in #{time_ago_in_words(@event.starts_at)}" : "#{time_ago_in_words(@event.starts_at)} ago" %>

<div class="container justify-content-between">
  <%= link_to 'Edit event', edit_event_path %>
  <p><%= @event.starts_at.strftime("%A, %B %d, %Y") %> | <%= relative_time(@event) %></p>
  <h1><%= @event.name %></h1>
  <p><%= @event.tickets.count %> tickets sold (<%= percentage_sold(@event) %>% of inventory) € sold</p>
  <div class="progress progress-thin">
    <div class="progress-bar" role="progressbar" style="width: <%= percentage_sold(@event) %>%;" aria-valuenow="<%= percentage_sold(@event) %>" aria-valuemin="0" aria-valuemax="100"></div>
  </div>

  <p><%= @event.venue.name %></p>

  <div class="row">
    <div class="col-6 pr-5">
      <div class="categories-progress">
        <% @event.event_categories.each do |category| %>
          <p><%= category.name %></p>
          <div class="progress progress-fat">
            <div class="progress-bar" role="progressbar" style="width: <%= category.percentage_sold %>;" aria-valuenow="<%= category.percentage_sold %>" aria-valuemin="0" aria-valuemax="100"><%= revenue(category) %></div>
          </div>
          <p><%= "#{category.tickets.count} sold / #{category.percentage_sold}%" %> - <%= category.capacity - category.tickets.count %></p>
        <% end %>
      </div>

      <div class="categories">
        <h5>Ticket prices</h5>
        <% @event.event_categories.each do |category| %>
          <div class="d-flex justify-content-between py-3 text-muted">
            <span><%= category.name %></span>
            <span class="flex-grow-1 bottom-dotted mx-3"></span>
            <span><%= category.price %> €</span>
          </div>
        <% end %>

      </div>
    </div>

    <div class="col-6 pl-5">
      <div class="d-flex align-items-center">
        <span class="bg-light px-2 rounded mr-2">https://www.tixfix.xyz/events/237</span>
        <span class="badge rounded-pill bg-danger text-white">Copy link</span>
      </div>

      <div id="map"
        style="width: 100%; height: 300px;"
        data-markers="<%= @marker.to_json %>"
        data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>

      <div class="venue-map">
        <% if @event.venue_map.attached? %>
          <%= cl_image_tag @event.venue_map.key, height: 300, width: 400, crop: :fill, alt: "venue map" %>
        <% elsif @event.venue.map.attached? %>
          <%= cl_image_tag @event.venue.map.key, height: 300, width: 400, crop: :fill, alt: "venue map" %>
        <% end %>
      </div>
    </div>
  </div>

  <br>


    <div class="d-flex justify-content-end mt-3 mb-5">

      <%= link_to events_path, method: :get, class: 'btn-2 mr-3' do %>
        Go Back
      <% end %>

      <%= link_to event_orders_path(@event.id), method: :get, class: 'btn-2 mr-3' do %>
        See Orders
      <% end %>

      <%= link_to new_event_order_path(@event.id), method: :get, class: 'btn-1 mr-3' do %>
        + New Order
      <% end %>

    </div>

</div>




<% if @event.image.attached? %>
  <%= cl_image_tag @event.image.key, height: 300, width: 400, crop: :fill, alt: "event flyer" %>
<% end %>
